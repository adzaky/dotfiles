#!/bin/bash
# MemUsed = Memtotal + Shmem - MemFree - Buffers - Cached - SReclaimable
# Source: https://github.com/KittyKatt/screenFetch/issues/386#issuecomment-249312716

while IFS=":" read -r a b; do
    case "$a" in
    "MemTotal")
        total="${b/kB/}"
        ;;
    "MemFree" | "Buffers" | "Cached" | "SReclaimable")
        used="$((used += ${b/kB/}))"
        ;;
    esac
done </proc/meminfo

normalize() {
    if [ $1 -gt 1048576 ]; then
        echo $(bc <<<"scale=2; ($1 / 1024)/1024") GB
    else
        echo $(($1 / 1024)) MB
    fi
}

freeMem=$((total - used))
printf '{"text":"%s","tooltip":"$tooltip","class":"$class"}' \
    "$(normalize $freeMem)"
